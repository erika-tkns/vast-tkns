{"version":3,"sources":["webpack:///webpack/bootstrap 08d8a087d13ea0bd6d08","webpack:///./~/vastjs/src/main.js","webpack:///./src/main.js"],"names":["Vast","require","document","addEventListener","player","createElement","width","height","body","appendChild","vast","load","vastUrl","then","play","timeupdate","currentTime","src","media"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AChEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,aAAa,YAAY;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc,OAAO;AACrB,cAAc;AACd;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,MAAM;AACnB,cAAc,OAAO;AACrB;AACA;AACA,4CAA4C,UAAU;AACtD;AACA;AACA,oFAAoF,KAAK;AACzF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,8BAA8B,KAAK;AACnC;AACA;AACA,iCAAiC,SAAS;AAC1C,0CAA0C;AAC1C;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,yBAAyB,MAAM;AAC/B,0BAA0B,OAAO;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;;AAEA;AACA;AACA,cAAc,MAAM;AACpB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,QAAQ;AACtB;AACA;AACA;AACA,kCAAkC,UAAU;AAC5C;AACA,KAAK;AACL,2CAA2C,UAAU;AACrD;AACA;;AAEA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,SAAS;AACvB,cAAc,SAAS;AACvB,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,SAAS,EAAE;AACrD,gDAAgD,WAAW,EAAE;AAC7D;AACA;AACA,KAAK;AACL;AACA,yCAAyC,EAAE;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA;AACA,cAAc,YAAY;AAC1B,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,UAAU;AAC1D;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc,QAAQ;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc,OAAO;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc;AACd;AACA;AACA,kCAAkC,UAAU;AAC5C;AACA,KAAK;;AAEL,kCAAkC,UAAU;AAC5C;AACA;AACA;AACA;AACA,qCAAqC,cAAc;AACnD,OAAO;AACP,mCAAmC,iBAAiB;AACpD,OAAO;AACP,mCAAmC,kBAAkB;AACrD,OAAO;AACP,mCAAmC,kBAAkB;AACrD,OAAO;AACP,mCAAmC,kBAAkB;AACrD,OAAO;AACP,mCAAmC,mBAAmB;AACtD,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,iBAAiB;AACpC,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,6CAA6C,OAAO,QAAQ,WAAW,YAAY,aAAa;AAChG;AACA,KAAK;AACL;;AAEA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,QAAQ;AACtB;AACA;AACA,+CAA+C,UAAU,0CAA0C,MAAM,aAAa,OAAO;AAC7H;AACA;AACA;;AAEA;AACA;AACA,cAAc,MAAM;AACpB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,QAAQ;AACtB;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;;AAGA;AACA;AACA,cAAc,QAAQ;AACtB,cAAc,OAAO;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;;;;;;;ACpXA;AACA,IAAMA,OAAO,mBAAAC,CAAQ,CAAR,CAAb;;AAEAC,SAASC,gBAAT,CAA0B,kBAA1B,EAA8C,YAAM;AAClD,MAAMC,SAASF,SAASG,aAAT,CAAuB,OAAvB,CAAf;AACAD,SAAOE,KAAP,GAAe,GAAf;AACAF,SAAOG,MAAP,GAAgB,GAAhB;AACAL,WAASM,IAAT,CAAcC,WAAd,CAA0BL,MAA1B;AACA,MAAMM,OAAO,IAAIV,IAAJ,CAASE,SAASM,IAAlB,CAAb;AACAE,OAAKC,IAAL,CAAUC,OAAV,EAAmBC,IAAnB,CAAwB,YAAM;AAC5BT,WAAOD,gBAAP,CAAwB,YAAxB,EAAsC,YAAM;AAC1CC,aAAOU,IAAP;AACD,KAFD;AAGAV,WAAOD,gBAAP,CAAwB,YAAxB,EAAsC,YAAM;AAC1CO,WAAKK,UAAL,CAAgBX,OAAOY,WAAvB;AACD,KAFD;AAGAZ,WAAOa,GAAP,GAAaP,KAAKQ,KAAL,CAAW,WAAX,CAAb;AACD,GARD;AASD,CAfD,E","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 08d8a087d13ea0bd6d08","/**\n * Vast manager\n * @author Eiji Kuroda\n * @license MIT\n */\n\n/** ****************************************************************************\n Vast XML\n*******************************************************************************/\nclass Vast {\n\n  /** **************************************************************************\n   * @param {HTMLElement} target target HTML element\n   ****************************************************************************/\n  constructor(target) {\n    this.duration = 0;\n    this.tracks = {};\n    this.tracked = {};\n    this.tracks.impressions = [];\n    this.tracks.progresses = [];\n    this.tracks.percents = [];\n    this.target = target;\n    this.wrapperNest = 0;\n  }\n\n  /** **************************************************************************\n   * vast loader\n   * @param  {String} url vast url\n   * @return {Promise}\n   ****************************************************************************/\n  load(url) {\n    return new Promise((resolve, reject) => {\n      this.myGetVast(url, resolve, reject);\n    });\n  }\n\n  /** **************************************************************************\n   * get media file url\n   * @param {String} type 'video/mp4' or 'video/webm' or etc.\n   * @param {Numer} bitrate kbps. pickup media file less than the bitrate.\n   * @return {String} video media url\n   ****************************************************************************/\n  media(type = 'video/mp4', bitrate = 1500) {\n    const root = this.vast.querySelector(`${this.base} Creatives Creative Linear MediaFiles`);\n    let selectedBitrate = 0;\n    let selected = null;\n    const medias = root.querySelectorAll(`MediaFile[delivery=\"progressive\"][type=\"${type}\"]`);\n    if (medias.length <= 0) {\n      return null;\n    }\n    selected = medias[0];\n    medias.forEach((elm) => {\n      const currBitrate = Number.parseInt(elm.getAttribute('bitrate'), 10);\n      if (currBitrate > selectedBitrate && currBitrate <= bitrate) {\n        selectedBitrate = currBitrate;\n        selected = elm;\n      }\n    });\n    return Vast.text(selected);\n  }\n\n  /** **************************************************************************\n   * check the vast has companion.\n   * @param  {Number} width companion width\n   * @param  {Number} height companion height\n   * @param  {Number} index index of list. default is 0.\n   * @return {Boolean} true:has false:not\n   ****************************************************************************/\n  hasCompanion(width, height, index = 0) {\n    const elm = this.myCompanion(width, height, index);\n    return !!elm;\n  }\n\n  /** **************************************************************************\n   * create companion html elements..\n   * @param  {Number} width companion width\n   * @param  {Number} height companion height\n   * @param  {Number} index index of list. default is 0.\n   * @return {Element} html element.\n   ****************************************************************************/\n  createCompanionElement(width, height, index = 0) {\n    const comp = this.myCompanion(width, height, index);\n    if (!comp) {\n      return null;\n    }\n    let elm;\n    if (comp.querySelector('StaticResource')) {\n      const url = Vast.text(comp.querySelector('StaticResource'));\n      elm = document.createElement('img');\n      elm.src = url;\n    } else if (comp.querySelector('IFrameResource')) {\n      const url = Vast.text(comp.querySelector('IFrameResource'));\n      elm = document.createElement('iframe');\n      elm.src = url;\n    } else if (comp.querySelector('HTMLResource')) {\n      const code = Vast.text(comp.querySelector('HTMLResource'));\n      elm = document.createElement('iframe');\n      elm.addEventListener('load', () => {\n        const doc = elm.contentWindow.document;\n        const html = `<body>${code}</body>`;\n        doc.open();\n        doc.write(html);\n        doc.write('<style> body {margin:0} </style>');\n        doc.write('<script>inDapIF = true;</script>');\n        doc.close();\n      }, false);\n    } else {\n      return null;\n    }\n    elm.style.width = `${width}px`;\n    elm.style.height = `${height}px`;\n    elm.addEventListener('click', (event) => {\n      if (!comp.querySelector('CompanionClickThrough')) {\n        event.preventDefault();\n        return;\n      }\n      const url = comp.querySelector('CompanionClickThrough');\n      const tracks = [];\n      comp.querySelectorAll('TrackingEvents Tracking').forEach((track) => {\n        tracks.push(Vast.text(track));\n      });\n      this.myTrackAndClick(tracks, url, 'companionClickTracking', '_blank').then(() => {\n        event.preventDefault();\n      });\n    });\n    return elm;\n  }\n\n  /** **************************************************************************\n   * timeupdate\n   * @param  {Float} current current time\n   * @return {Promise} possible to wait all beacons finished\n   ****************************************************************************/\n  timeupdate(current) {\n    if (!this.tracking) {\n      return Promise.resolve();\n    }\n    const promises = [];\n    const trackSmaller = (name, org, target) => {\n      const removes = org.filter(o => o.offset <= target);\n      const remains = org;\n      removes.forEach(k => delete remains[k]);\n      removes.forEach(trc => promises.push(this.myDispatch(name, trc.url)));\n      return remains;\n    };\n    this.tracks.percents = trackSmaller('percents', this.tracks.percents, (current / this.duration) * 100.0);\n    this.tracks.progresses = trackSmaller('progresses', this.tracks.progresses, current);\n    return Promise.all(promises);\n  }\n\n  /** **************************************************************************\n   * dispatch event\n   * @param  {String} eventName event name. i.e. 'impression'.\n   * @return {Promise} possible to wait all beacons finished\n   ****************************************************************************/\n  dispatchEvent(eventName) {\n    const promises = [];\n    if (this.tracks[eventName]) {\n      this.tracks[eventName].forEach((url) => {\n        promises.push(this.myDispatch(eventName, url));\n      });\n    }\n    return Promise.all(promises);\n  }\n\n  /** **************************************************************************\n   * click video\n   * @param  {String} target target window. default is '_blank'.\n   * @return {Promise} possible to wait all beacons finished\n   ****************************************************************************/\n  clickVideo(target = '_blank') {\n    const tracks = [];\n    this.vast.querySelectorAll(`${this.base} Creatives Creative Linear VideoClicks ClickTracking`).forEach((track) => {\n      tracks.push(Vast.text(track));\n    });\n    const url = this.vast.querySelector(`${this.base} Creatives Creative Linear VideoClicks ClickThrough`);\n    return this.myTrackAndClick(tracks, url, 'videoClicksTracking', target);\n  }\n\n  /** **************************************************************************\n   * LOCAL : get vast xml\n   * @param  {String} url  url\n   * @param  {Function} resolve resolve callback\n   * @param  {Function} reject  reject callback\n   * @return {void}\n   ****************************************************************************/\n  myGetVast(url, resolve, reject) {\n    const u = url.replace('$rand$', Math.random(Date.now()));\n    new Promise((ok, ng) => {\n      const xhr = new XMLHttpRequest();\n      xhr.responseType = 'document';\n      xhr.withCredentials = true;\n      xhr.addEventListener('load', () => { ok(xhr); }, false);\n      xhr.addEventListener('error', (error) => { ng(error); }, false);\n      xhr.open('GET', u, true);\n      xhr.send();\n    }).then((xhr) => {\n      if (xhr.status !== 200) {\n        reject(new Error(`invalid url :${u}`));\n        return;\n      }\n      try {\n        this.myBuild(xhr.response);\n        if (this.myIsWrapper()) {\n          if (this.wrapperNest >= 5) {\n            throw new Error('The vast wrapper is deeper 5 level nest.');\n          }\n          this.wrapperNest += 1;\n          this.myGetVast(this.myWrapperUrl(), resolve, reject);\n          return;\n        }\n      } catch (error) {\n        reject(error);\n      }\n      resolve(this);\n    }, (error) => {\n      reject(error);\n    });\n  }\n\n  /** **************************************************************************\n   * LOCAL : build Vast\n   * @param  {XMLDocument} vast vast document\n   * @return {Promise}\n   ****************************************************************************/\n  myBuild(vast) {\n    if (typeof vast === 'undefined') {\n      throw new Error('vast format error');\n    }\n    this.vast = vast;\n    this.base = this.myIsWrapper() ? 'VAST Ad Wrapper ' : 'VAST Ad InLine ';\n    this.myTrackingEvents();\n    const duration = this.vast.querySelector(`${this.base} Creatives Creative Linear Duration`);\n    if (duration) {\n      this.duration = Vast.sec(Vast.text(duration));\n    }\n    this.tracking = true;\n  }\n\n  /** **************************************************************************\n   * LOCAL : Check the vast is wrapper or not.\n   * @return {Boolean} true:vast is wrapper, false:not\n   ****************************************************************************/\n  myIsWrapper() {\n    return !!this.vast.querySelector('VAST Ad Wrapper');\n  }\n\n  /** **************************************************************************\n   * LOCAL : Get the wrapper url.\n   * @return {String} wrapped vast url\n   ****************************************************************************/\n  myWrapperUrl() {\n    return Vast.text(this.vast.querySelector('VAST Ad Wrapper VASTAdTagURI'));\n  }\n\n  /** **************************************************************************\n   * LOCAL : build tracking event urls\n   * @return {void}\n   ****************************************************************************/\n  myTrackingEvents() {\n    this.vast.querySelectorAll(`${this.base} Impression`).forEach((track) => {\n      this.tracks.impressions.push(Vast.text(track));\n    });\n\n    this.vast.querySelectorAll(`${this.base} Creatives Creative Linear TrackingEvents Tracking`).forEach((track) => {\n      const name = track.getAttribute('event');\n      const url = Vast.text(track);\n      if (name === 'progress') {\n        const offset = Vast.sec(track.getAttribute('offset'));\n        this.tracks.progresses.push({ offset, url });\n      } else if (name === 'start') {\n        this.tracks.percents.push({ offset: 0, url });\n      } else if (name === 'firstQuartile') {\n        this.tracks.percents.push({ offset: 25, url });\n      } else if (name === 'midpoint') {\n        this.tracks.percents.push({ offset: 50, url });\n      } else if (name === 'thirdQuartile') {\n        this.tracks.percents.push({ offset: 75, url });\n      } else if (name === 'complete') {\n        this.tracks.percents.push({ offset: 100, url });\n      } else {\n        this.tracks[name] = this.tracks[name] ? this.tracks[name] : [];\n        this.tracks[name].push(url);\n      }\n    });\n  }\n\n  /** **************************************************************************\n   * dispatch vast event\n   * @param  {String} eventName event name\n   * @param  {String} url beacon url\n   * @return {Promise} possible to wait beacon finished\n   ****************************************************************************/\n  myDispatch(eventName, url) {\n    const img = document.createElement('img');\n    return new Promise((resolve) => {\n      img.addEventListener('load', () => {\n        this.target.removeChild(img);\n        this.target.dispatchEvent(new CustomEvent('vastEvent', {\n          detail: { eventName, url }, bubbles: true,\n        }));\n        if (typeof this.tracked[eventName] === 'undefined') {\n          this.tracked[eventName] = [];\n        }\n        this.tracked[eventName].push(url);\n        resolve();\n      });\n      img.src = url;\n      img.style.cssText = 'position:absolute; top:0; left:0; width:1px; height:1px; opacity:0.1;';\n      this.target.appendChild(img);\n    });\n  }\n\n  /** **************************************************************************\n   * get companion ad\n   * @param  {Number} width companion width\n   * @param  {Number} height companion height\n   * @param  {Number} index index of list. default is 0.\n   * @return {Element} companion element\n   ****************************************************************************/\n  myCompanion(width = 0, height = 0, index = 0) {\n    const elms = this.vast.querySelectorAll(`${this.base} Creative CompanionAds Companion[width=\"${width}\"][height=\"${height}\"]`);\n    const elm = elms[index];\n    return elm;\n  }\n\n  /** **************************************************************************\n   * LOCAL : tracking and click\n   * @param  {Array} trackings tracking urls\n   * @param  {String} url  click url\n   * @param  {String} eventName  click event name\n   * @param  {String} target  click target. default '_blank'\n   * @return {Promise} possible to wait all beacons finished\n   ****************************************************************************/\n  myTrackAndClick(trackings, url, eventName, target = '_blank') {\n    const promises = [];\n    trackings.forEach((trackUrl) => {\n      promises.push(this.myDispatch(eventName, trackUrl));\n    });\n    const a = document.createElement('a');\n    return Promise.all(promises).then(() => {\n      a.href = url;\n      a.target = target;\n      a.click();\n    });\n  }\n\n\n  /** **************************************************************************\n  * convert element to string.\n   * @param  {Element} elm xml element\n   * @return {String} trimed text content\n   ****************************************************************************/\n  static text(elm) {\n    if (elm === false || typeof elm === 'undefined') {\n      return null;\n    }\n    return elm.textContent.trim();\n  }\n\n  /** **************************************************************************\n   * convert string to sec.\n   * @param  {String} hms like '12:34:56'\n   * @return {Number} sec\n   ****************************************************************************/\n  static sec(hms) {\n    const s = hms.split(':');\n    return (parseInt(s[0], 10) * 3600) + (parseInt(s[1], 10) * 60) + parseInt(s[2], 10);\n  }\n\n}\n\nmodule.exports = Vast;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/vastjs/src/main.js\n// module id = 0\n// module chunks = 0","/*  global vastUrl */\nconst Vast = require('vastjs');\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const player = document.createElement('video');\n  player.width = 775;\n  player.height = 436;\n  document.body.appendChild(player);\n  const vast = new Vast(document.body);\n  vast.load(vastUrl).then(() => {\n    player.addEventListener('loadeddata', () => {\n      player.play();\n    });\n    player.addEventListener('timeupdate', () => {\n      vast.timeupdate(player.currentTime);\n    });\n    player.src = vast.media('video/mp4');\n  });\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js"],"sourceRoot":""}